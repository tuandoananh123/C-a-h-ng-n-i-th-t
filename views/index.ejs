<%- include('./partials/header') %>

<!-- Hero Section -->
<section class="hero-section">
    <div id="heroCarousel" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-indicators">
            <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="0" class="active"></button>
            <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="1"></button>
            <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="2"></button>
        </div>
        <div class="carousel-inner">
            <div class="carousel-item active">
                <img src="/images/hero-1.jpg" class="d-block w-100" alt="Nhà bếp hiện đại">
                <div class="carousel-caption">
                    <h1 class="display-4 fw-bold">Nâng Tầm Không Gian Sống</h1>
                    <p class="lead">Khám phá bộ sưu tập đồ gia dụng cao cấp cho ngôi nhà của bạn</p>
                    <a href="/products" class="btn btn-primary btn-lg">Mua sắm ngay</a>
                </div>
            </div>
            <div class="carousel-item">
                <img src="/images/hero-2.jpg" class="d-block w-100" alt="Phòng khách sang trọng">
                <div class="carousel-caption">
                    <h1 class="display-4 fw-bold">Ưu Đãi Mùa Hè</h1>
                    <p class="lead">Giảm giá lên đến 50% cho các sản phẩm nhà bếp</p>
                    <a href="/products?category=Nhà bếp" class="btn btn-primary btn-lg">Xem ngay</a>
                </div>
            </div>
            <div class="carousel-item">
                <img src="/images/hero-3.jpg" class="d-block w-100" alt="Đồ điện tử thông minh">
                <div class="carousel-caption">
                    <h1 class="display-4 fw-bold">Nhà Thông Minh</h1>
                    <p class="lead">Trải nghiệm cuộc sống tiện nghi với các thiết bị smart home</p>
                    <a href="/products?category=Đồ điện tử" class="btn btn-primary btn-lg">Khám phá</a>
                </div>
            </div>
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
        </button>
    </div>
</section>

<!-- Categories Section -->
<section class="categories-section py-5">
    <div class="container">
        <h2 class="text-center mb-5">Danh Mục Sản Phẩm</h2>
        <div class="row g-4">
            <div class="col-md-4 col-sm-6">
                <div class="category-card">
                    <img src="/images/category-kitchen.jpg" alt="Nhà bếp" class="img-fluid">
                    <div class="category-overlay">
                        <h3>Nhà Bếp</h3>
                        <a href="/products?category=Nhà bếp" class="btn btn-outline-light">Xem sản phẩm</a>
                    </div>
                </div>
            </div>
            <div class="col-md-4 col-sm-6">
                <div class="category-card">
                    <img src="/images/category-bedroom.jpg" alt="Phòng ngủ" class="img-fluid">
                    <div class="category-overlay">
                        <h3>Phòng Ngủ</h3>
                        <a href="/products?category=Phòng ngủ" class="btn btn-outline-light">Xem sản phẩm</a>
                    </div>
                </div>
            </div>
            <div class="col-md-4 col-sm-6">
                <div class="category-card">
                    <img src="/images/category-bathroom.jpg" alt="Phòng tắm" class="img-fluid">
                    <div class="category-overlay">
                        <h3>Phòng Tắm</h3>
                        <a href="/products?category=Phòng tắm" class="btn btn-outline-light">Xem sản phẩm</a>
                    </div>
                </div>
            </div>
            <div class="col-md-4 col-sm-6">
                <div class="category-card">
                    <img src="/images/category-livingroom.jpg" alt="Phòng khách" class="img-fluid">
                    <div class="category-overlay">
                        <h3>Phòng Khách</h3>
                        <a href="/products?category=Phòng khách" class="btn btn-outline-light">Xem sản phẩm</a>
                    </div>
                </div>
            </div>
            <div class="col-md-4 col-sm-6">
                <div class="category-card">
                    <img src="/images/category-electronics.jpg" alt="Đồ điện tử" class="img-fluid">
                    <div class="category-overlay">
                        <h3>Đồ Điện Tử</h3>
                        <a href="/products?category=Đồ điện tử" class="btn btn-outline-light">Xem sản phẩm</a>
                    </div>
                </div>
            </div>
            <div class="col-md-4 col-sm-6">
                <div class="category-card">
                    <img src="/images/category-furniture.jpg" alt="Đồ nội thất" class="img-fluid">
                    <div class="category-overlay">
                        <h3>Đồ Nội Thất</h3>
                        <a href="/products?category=Đồ nội thất" class="btn btn-outline-light">Xem sản phẩm</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Featured Products Section -->
<section class="featured-products py-5 bg-light">
    <div class="container">
        <h2 class="text-center mb-5">Sản Phẩm Nổi Bật</h2>
        <div id="featured-products">
            <!-- Products will be loaded dynamically from API -->
            <div class="text-center py-4">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>
        </div>
        <div class="text-center mt-4">
            <a href="/products" class="btn btn-primary">Xem tất cả sản phẩm</a>
        </div>
    </div>
</section>

<!-- Benefits Section -->
<section class="benefits-section py-5">
    <div class="container">
        <h2 class="text-center mb-5">Tại Sao Chọn Chúng Tôi</h2>
        <div class="row g-4">
            <div class="col-md-3 col-sm-6">
                <div class="benefit-card text-center">
                    <div class="benefit-icon">
                        <i class="fas fa-truck"></i>
                    </div>
                    <h4>Giao Hàng Miễn Phí</h4>
                    <p>Miễn phí giao hàng cho đơn hàng từ 500.000đ</p>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="benefit-card text-center">
                    <div class="benefit-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <h4>Bảo Hành An Tâm</h4>
                    <p>Bảo hành lên đến 24 tháng cho các sản phẩm</p>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="benefit-card text-center">
                    <div class="benefit-icon">
                        <i class="fas fa-exchange-alt"></i>
                    </div>
                    <h4>Đổi Trả Dễ Dàng</h4>
                    <p>30 ngày đổi trả miễn phí nếu không hài lòng</p>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="benefit-card text-center">
                    <div class="benefit-icon">
                        <i class="fas fa-headset"></i>
                    </div>
                    <h4>Hỗ Trợ 24/7</h4>
                    <p>Đội ngũ chăm sóc khách hàng luôn sẵn sàng hỗ trợ</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Newsletter Section -->
<section class="newsletter-section py-5 bg-primary text-white">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-6">
                <h3>Đăng ký nhận tin</h3>
                <p>Nhận thông tin về sản phẩm mới và ưu đãi đặc biệt</p>
            </div>
            <div class="col-md-6">
                <form class="newsletter-form d-flex">
                    <input type="email" class="form-control me-2" placeholder="Nhập email của bạn" required>
                    <button type="submit" class="btn btn-light">Đăng ký</button>
                </form>
            </div>
        </div>
    </div>
</section>

<script>
// Fetch and display featured products
document.addEventListener('DOMContentLoaded', function() {
    fetch('/api/products/featured')
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                displayFeaturedProducts(data.data);
            }
        })
        .catch(err => console.error('Error fetching featured products:', err));
});

function displayFeaturedProducts(products) {
    const productsContainer = document.getElementById('featured-products');
    
    // Clear loading spinner
    productsContainer.innerHTML = '';
    
    if (products.length === 0) {
        productsContainer.innerHTML = '<div class="col-12 text-center"><p>Không có sản phẩm nổi bật.</p></div>';
        return;
    }
    
    // Cria um wrapper div para melhor controle do layout
    let html = '<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">';
    
    // Generate product cards
    products.forEach(product => {
        const productImage = product.images && product.images.length > 0 ? product.images[0] : '/images/default-product.jpg';
        
        html += `
            <div class="col">
                <div class="product-card">
                    <div class="product-image">
                        <img src="${productImage}" alt="${product.name}" class="img-fluid">
                        <div class="product-overlay">
                            <a href="/products/${product._id}" class="btn btn-sm btn-outline-light">Chi tiết</a>
                            <button class="btn btn-sm btn-primary add-to-cart" data-id="${product._id}">Thêm vào giỏ</button>
                        </div>
                    </div>
                    <div class="product-info">
                        <h5><a href="/products/${product._id}">${product.name}</a></h5>
                        <div class="product-price">${formatPrice(product.price)} đ</div>
                    </div>
                </div>
            </div>
        `;
    });
    
    html += '</div>';
    productsContainer.innerHTML = html;
    
    // Add event listeners for add to cart buttons
    document.querySelectorAll('.add-to-cart').forEach(button => {
        button.addEventListener('click', function() {
            const productId = this.getAttribute('data-id');
            addToCart(productId, 1);
        });
    });
}

function formatPrice(price) {
    return price.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
}

function addToCart(productId, quantity) {
    fetch('/api/cart/add', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ productId, quantity })
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            // Update cart count
            document.getElementById('cart-count').textContent = data.data.totalQuantity;
            
            // Show success message
            alert('Sản phẩm đã được thêm vào giỏ hàng!');
        } else {
            alert(data.error || 'Đã xảy ra lỗi. Vui lòng thử lại sau.');
        }
    })
    .catch(err => {
        console.error('Error adding to cart:', err);
        alert('Đã xảy ra lỗi. Vui lòng thử lại sau.');
    });
}
</script>

<%- include('./partials/footer') %>
